---
name: autonomous-dev
description: Orchestrate autonomous development by executing tasks from the tasks document sequentially. Auto-detects the first incomplete task, executes development work, MUST run /codex-review for validation after EVERY task, auto-fixes any findings, and commits on success. Stops only after max retries (3) or unfixable issues.
---

# Autonomous Development Orchestrator

## Overview

This skill automates the development workflow by reading tasks from the project task breakdown document, executing them one by one, **validating with Codex review (COMPULSORY after every task)**, automatically fixing any review findings, and committing progress. It maintains a continuous development loop until all tasks are complete or an unfixable issue is encountered after multiple retry attempts.

**CRITICAL RULE:** The `/codex-review` skill MUST be run after completing each task, before any commit. No task is considered complete without passing code review. This is non-negotiable.

## Integration with Session Protocols

This skill integrates with the framework's session management:

### Cold Start Integration
When starting, the skill checks `dev-docs/snapshot.md` to:
- Identify where the previous session left off
- Resume from the last incomplete task
- Load relevant context efficiently

### Completion Integration
After each task or when ending:
- Updates `dev-docs/snapshot.md` with current state
- Tracks session progress for future sessions
- Enables seamless resume on next session

### Operational Commands Available
During development, you can use these commands (see `.claude/commands/`):
- `/commit` - Create structured git commits
- `/fix` - Debug and fix issues
- `/refactor` - Improve code structure
- `/security` - Run security audit
- `/test` - Write and run tests

## Prerequisites

Before running, ensure the following documents exist (generated by the corresponding skills):
- **Tasks:** `dev-docs/to-do.md` (generated by `/to-do`)
- **PRD:** `dev-docs/prd.md` (generated by `/prd`)
- **TRD:** `dev-docs/trd.md` (generated by `/trd`)
- **Snapshot:** `dev-docs/snapshot.md` (auto-created/updated by protocols)

Additionally:
- The `/codex-review` skill is available and working
- `tmux` and `codex` CLI are installed (required by codex-review)
- Git is configured with appropriate credentials

**Recommended Workflow:**
```
/prd <product idea>  →  Creates dev-docs/prd.md
/trd                 →  Creates dev-docs/trd.md
/to-do               →  Creates dev-docs/to-do.md
"start"              →  Cold Start Protocol (loads context)
/autonomous-development  →  Executes tasks from to-do.md
"done"               →  Completion Protocol (saves state)
```

## Available Skills

The following skills can be invoked during autonomous development using the Skill tool:

### `/codex-review` (COMPULSORY)
**Purpose:** Validate code changes before committing
**When to use:** **MUST be run after completing EVERY task, before committing. This is mandatory.**
```
Invoke using Skill tool:
- skill: "codex-review"
```
**IMPORTANT:** Never skip this step. Never commit without running /codex-review first. A task is not complete until it passes code review.

### `/vercel-react-best-practices`
**Purpose:** Get performance optimization guidance for React/Next.js code
**When to use:**
- Before implementing complex React components
- When optimizing data fetching or bundle size
- When fixing performance-related review findings
```
Invoke using Skill tool:
- skill: "vercel-react-best-practices"
```

### `/web-design-guidelines`
**Purpose:** Review UI code for accessibility and design compliance
**When to use:**
- After implementing UI components
- When fixing accessibility-related review findings
- To audit completed sections against best practices
```
Invoke using Skill tool:
- skill: "web-design-guidelines"
- args: "<file-or-pattern>" (e.g., "src/components/sections/Hero.tsx")
```

**Usage Pattern:**
```
1. Before implementing a UI component:
   - Optionally invoke /vercel-react-best-practices for performance patterns

2. After implementing a UI component:
   - Invoke /web-design-guidelines with the component file to check compliance
   - Fix any findings before proceeding to /codex-review

3. After completing ANY task (MANDATORY - NO EXCEPTIONS):
   - MUST invoke /codex-review for validation
   - Fix any findings
   - Only commit after review passes
```

## Reference Documents

Always consult these documents for implementation context:
- **PRD:** `dev-docs/prd.md` - Product requirements, user stories, features, and success criteria
- **TRD:** `dev-docs/trd.md` - Architecture, technology stack, API design, and implementation details
- **Tasks:** `dev-docs/to-do.md` - Task breakdown with phase organization and traceability references

**Document Relationships:**
- Tasks in `to-do.md` reference PRD sections (e.g., `PRD FR-001`, `PRD US-003`)
- Tasks in `to-do.md` reference TRD sections (e.g., `TRD 3.2`, `TRD 5.1`)
- Use these references to look up detailed context when implementing each task

## Development Standards

**CRITICAL:** When implementing any development task, you MUST reference and apply the following guidelines. These are available both as documentation to read AND as skills you can invoke:

### 1. React/Next.js Best Practices
**Reference:** `.claude/skills/vercel-react-best-practices/`
**Skill:** `/vercel-react-best-practices` (invoke for guidance on specific patterns)

Apply these rules during all React/Next.js development:
- **Eliminating Waterfalls** - Use `Promise.all()`, defer awaits, use Suspense boundaries
- **Bundle Size Optimization** - Avoid barrel imports, use `next/dynamic`, defer third-party scripts
- **Server-Side Performance** - Use `React.cache()`, minimize client data serialization
- **Re-render Optimization** - Memoize expensive components, use primitive dependencies
- **Rendering Performance** - Use `content-visibility`, hoist static JSX

For detailed rules, read:
- `.claude/skills/vercel-react-best-practices/SKILL.md` for quick reference
- `.claude/skills/vercel-react-best-practices/AGENTS.md` for full compiled guidelines
- Individual rule files in `.claude/skills/vercel-react-best-practices/rules/`

### 2. Web Interface Guidelines
**Reference:** `.claude/skills/web-design-guidelines/`
**Skill:** `/web-design-guidelines` (invoke to audit UI components)

All UI components must comply with web interface best practices:
- Accessibility (WCAG 2.1 AA compliance)
- Keyboard navigation support
- Proper semantic HTML structure
- Focus management and indicators
- Color contrast requirements

Before completing any UI task, mentally audit against these guidelines.

## Task Format Reference

Tasks in the development todo follow a checkbox-based structure organized by phases:

```
## Phase N: [Phase Name]

### [Category Name]
- [ ] Task item 1
- [ ] Task item 2
- [ ] Task item 3
```

### Status Markers

| Marker | Meaning |
|--------|---------|
| `- [ ]` | Not started - Available to work on |
| `- [x]` | Completed - Done and verified |

### Summary Table

The document includes a summary table tracking phase completion:

```
| Phase | Items | Status |
|-------|-------|--------|
| 1. Project Setup | 14 | [Status] |
...
```

Update the status column when a phase is complete.

## The Process

### Step 1: Detect Start Point

Scan the tasks document to find the first incomplete task.

```
1. Read dev-docs/to-do.md
2. Parse all phases and their tasks looking for unchecked items `- [ ]`
3. Find FIRST unchecked task item
4. Identify the Phase and Category it belongs to
5. Note any PRD/TRD references in parentheses (e.g., "TRD 3.2", "PRD FR-001")
6. Check if any prerequisite phases need completion first
```

**Dependency Check:**
- Phases should generally be completed in order (1 → 2 → 3 → etc.)
- Some tasks within a phase can be parallelized if independent
- If a task clearly depends on another incomplete task, skip to the next available task

### Step 2: Read Context Documents

Before executing any task, load relevant context:

```
1. Read the PRD (dev-docs/prd.md) for product context:
   - User stories and use cases
   - Feature descriptions and priorities
   - Non-functional requirements
2. Read the TRD (dev-docs/trd.md) for technical context:
   - Technology stack and architecture
   - Database schema and API design
   - Implementation standards
3. If task has references (e.g., "TRD 3.2"), read that specific section
4. Keep this context in mind during implementation
```

**For UI/Component Tasks:**
```
1. Reference TRD Section 2 (Technology Stack) for frontend framework
2. Reference TRD Section 6 (User Experience) for design patterns
3. Load the vercel-react-best-practices guidelines if using React/Next.js
```

### Step 3: Execute Development Work

Implement the task according to its description and project standards.

```
1. Read the task description thoroughly
2. Review related tasks in the same category for context
3. Check the technical spec for implementation details
4. For complex UI/performance tasks, optionally invoke helper skills:
   - Invoke /vercel-react-best-practices for performance patterns
   - These skills provide guidance BEFORE you write code
5. Implement the required code changes:
   - Create new files as needed
   - Modify existing files
   - Follow existing code patterns and conventions
   - Apply React/Next.js best practices
   - Ensure accessibility compliance
6. After implementing UI components, invoke /web-design-guidelines:
   - skill: "web-design-guidelines"
   - args: "<path-to-component>"
   - Fix any accessibility/design findings
7. Mark task checkbox as complete in the tasks document as you finish
```

**Implementation Guidelines:**
- Follow the directory structure from TRD Section 2 (Technology Stack)
- Use the technology stack specified in TRD (language, framework, etc.)
- Follow coding standards from TRD Section 10 (Development Standards)
- Reference TRD Section 3 (Database Design) for data models
- Reference TRD Section 4 (API Design) for endpoint implementation
- Reference PRD Section 5 (Features & Requirements) for acceptance criteria
- Apply patterns from TRD Section 6 (Performance Requirements) where applicable

**Performance Checklist (if using React/Next.js - apply vercel-react-best-practices):**
- [ ] Images optimized (Next.js `<Image>` or equivalent)
- [ ] No barrel imports that bloat bundle size
- [ ] Heavy components dynamically imported
- [ ] Async operations use `Promise.all()` where independent
- [ ] Components properly memoized where needed
- [ ] Server-side rendering used where beneficial

**Accessibility Checklist (for web projects - apply web-design-guidelines):**
- [ ] Semantic HTML structure (header, main, nav, footer, section)
- [ ] Proper heading hierarchy (H1 → H2 → H3)
- [ ] All interactive elements keyboard accessible
- [ ] Focus indicators visible
- [ ] Alt text on all meaningful images
- [ ] Form labels properly associated
- [ ] Color contrast meets WCAG AA (4.5:1 for text)

**General Quality Checklist:**
- [ ] Code follows TRD Section 10 (Development Standards)
- [ ] Error handling per TRD Section 13
- [ ] Tests written per TRD Section 11 (Testing Strategy)
- [ ] No security vulnerabilities per TRD Section 14

### Step 4: Run Codex Review (COMPULSORY)

**THIS STEP IS MANDATORY.** After completing the development work, you MUST invoke the codex-review skill for validation. Never skip this step. Never commit without review.

```
Invoke the /codex-review skill using the Skill tool:
- skill: "codex-review"

Wait for the review to complete (up to 60 minutes as per skill timeout).

⚠️  DO NOT PROCEED TO COMMIT WITHOUT RUNNING THIS STEP
⚠️  NO EXCEPTIONS - EVERY TASK REQUIRES CODE REVIEW
```

**Interpreting Review Results:**

The review will analyze uncommitted changes and provide feedback.

**PASS indicators:**
- No critical issues identified
- Code follows best practices
- Implementation is complete and correct
- Output contains approval language or no blockers

**FAIL indicators:**
- Critical bugs or errors identified
- Missing implementation
- Security issues
- Significant code quality concerns
- Review explicitly recommends changes before commit

### Step 4a: Parse Review Findings

After receiving the review output, parse it for specific findings:

**Finding Severity Levels:**

| Level | Meaning | Action |
|-------|---------|--------|
| P1 | Critical - Security, data loss, crash | Attempt fix immediately |
| P2 | Moderate - Incorrect behavior, missing validation | Fix before commit |
| P3 | Minor - Code quality, incomplete coverage | Fix if straightforward |

**Parsing Pattern:**

Look for lines matching: `- P[1-3] (critical|moderate|minor): [description]`

Extract for each finding:
- Severity level (P1/P2/P3)
- Category (critical/moderate/minor)
- Description of the issue
- Affected component (if mentioned)

**What Makes a Finding Fixable:**
- **Fixable:** Missing imports, incomplete handling, missing edge cases, code style issues, unused variables, minor validation gaps, accessibility issues, performance optimizations
- **Unfixable:** Fundamental architecture problems, missing requirements/specs, issues outside current task scope

### Step 5: Handle Review Outcome

#### If Review PASSES:

```
1. Create a descriptive commit message:
   - Format: "feat(scope): [Brief description]"
   - Include phase/task reference in commit body
   - Reference any best practices applied

   Example:
   feat(ui): Add Hero section with responsive layout

   - Implement split-layout grid (text left, image right)
   - Add entrance animation with Framer Motion
   - Apply Next.js Image optimization with priority loading
   - Ensure WCAG AA compliance for contrast

   Phase 5: Section Components - Hero
   Applied: async-suspense-boundaries, rendering-hoist-jsx

2. Stage all relevant changes: git add [files]
3. Commit with the message
4. Update task checkbox in tasks document:
   - Change `- [ ]` to `- [x]`
5. Update dev-docs/snapshot.md:
   - Set "Last Task" to the completed task
   - Set "Next Task" to the next pending task
   - Update session history with task completion
   - Note any key decisions made
6. Move to next task (return to Step 1)
```

#### If Review has FIXABLE Findings:

Enter the fix-and-retry loop:

```
MAX_RETRIES = 3
retry_count = 0

While retry_count < MAX_RETRIES:
   1. Parse all findings from review output (see Step 4a)
   2. For each finding:
      a. Identify the affected file(s) and location
      b. Understand what needs to be fixed
      c. Reference best practices if it's a performance/accessibility issue
      d. Implement the fix following existing code patterns
      e. Verify the fix addresses the finding
   3. Log what was fixed:
      [FIX] Retry {retry_count + 1}/3 - Fixing {count} finding(s)...
      [FIX] {description of each fix}
   4. Re-run /codex-review
   5. If review PASSES:
      - Break loop
      - Proceed to commit (include fix info in message)
   6. retry_count += 1

If loop exhausted (retry_count >= MAX_RETRIES):
   - STOP for manual intervention
   - Report remaining unfixed issues
   - Leave changes uncommitted
   - Keep task unchecked
```

**Guidelines for Fixing:**
- Fix issues in order of severity (P1 first, then P2, then P3)
- Read the affected files before making changes
- Follow existing code patterns and style
- For performance-related findings:
  - Invoke `/vercel-react-best-practices` skill for guidance
  - Apply the relevant optimization patterns
- For accessibility-related findings:
  - Invoke `/web-design-guidelines` skill with the affected file
  - Follow the specific recommendations
- If a fix seems too complex or risky, mark it as unfixable

#### If Review has UNFIXABLE Issues:

Issues are unfixable when:
- Fundamental architecture problems requiring redesign
- Missing requirements/specs that need clarification
- Issues outside the current task scope
- Reviewer explicitly recommends manual review
- Fix would require changes to multiple unrelated areas

```
1. STOP the autonomous loop immediately
2. Report the failure with:
   - Current phase and task
   - Review feedback summary
   - Specific issues that couldn't be fixed
   - Why they are unfixable
3. Leave changes uncommitted for manual review
4. Keep task checkbox unchecked `- [ ]`
5. Wait for user intervention
```

### Step 6: Loop Continuation

After successful commit, check for more tasks:

```
1. Re-read the tasks document
2. Find next unchecked task `- [ ]`
3. If found: Return to Step 1
4. If none found: Report completion
   - List all tasks completed in this session
   - Show summary of commits made
   - Report any skipped/blocked tasks
```

## Commit Message Format

Use conventional commit format with task context:

```
<type>(<scope>): <Short description>

<Body explaining what was done>

Phase: <Phase Number> - <Phase Name>
Task: <Category> - <Task description>
Best Practices Applied: <rule-names if applicable>
```

**When fix iterations occurred, include:**

```
<type>(<scope>): <Short description>

<Body explaining what was done>

Phase: <Phase Number> - <Phase Name>
Task: <Category> - <Task description>
Review: Passed after N fix iteration(s)
Fixed:
- [P-level]: [brief description of fix]
```

**Example with fix iterations:**
```
feat(layout): Implement sticky Navigation component

- Create fixed header with glassmorphism on scroll
- Add smooth scroll to anchor links
- Implement mobile hamburger menu
- Apply focus-visible styles for accessibility

Phase: 4 - Layout Components
Task: Navigation - Create sticky header structure
Best Practices Applied: bundle-dynamic-imports, rendering-hoist-jsx
Review: Passed after 1 fix iteration
Fixed:
- [P3]: Added aria-label to hamburger button
```

**Types:**
- `feat` - New feature or functionality
- `fix` - Bug fix
- `refactor` - Code refactoring
- `style` - Styling changes
- `perf` - Performance improvement
- `a11y` - Accessibility improvement
- `test` - Adding tests
- `docs` - Documentation
- `chore` - Maintenance tasks

**Scope examples:**
- `layout` - Navigation, Footer, Layout components
- `hero` - Hero section
- `services` - Services section
- `cta` - CTA/Contact section
- `ui` - UI components (Button, Input, etc.)
- `form` - Form handling and validation
- `api` - API routes
- `config` - Configuration files

## Status Update Format

When updating task status in the tasks document:

**From Not Started to Completed:**
```
- [ ] Task item
```
becomes:
```
- [x] Task item
```

**Phase Summary Table Update:**
When all tasks in a phase are complete, update the summary:
```
| 1. Project Setup | 14 | ⬜ |
```
becomes:
```
| 1. Project Setup | 14 | ✅ |
```

## Example Session Output

### Example: Clean Pass (No Findings)

```
=== Autonomous Development Session Started ===

[SCAN] Reading tasks document...
[FOUND] First incomplete task: Phase 1 > Environment Setup > Initialize project with Next.js 14+ (App Router)

[CONTEXT] Loading Requirements and Technical Spec...
[CONTEXT] Loading React best practices guidelines...

[EXECUTE] Starting task implementation...
- Running: npx create-next-app@latest with App Router
- Configuring TypeScript
- Setting up project structure per technical spec
[EXECUTE] Task implementation complete

[REVIEW] Invoking /codex-review...
[REVIEW] Waiting for Codex review completion...
[REVIEW] Review complete - PASSED

[COMMIT] Creating commit...
feat(config): Initialize Next.js 14 project with App Router

[STATUS] Updating task to [x]

[SCAN] Looking for next task...
[FOUND] Next task: Phase 1 > Environment Setup > Configure TypeScript

... continues ...
```

### Example: Fix-and-Retry Loop

```
[EXECUTE] Task implementation complete (Hero section)

[SKILL] Invoking /web-design-guidelines for Hero.tsx...
[SKILL] Guidelines review found 2 issues:
  - Missing alt text on hero image
  - Missing aria-label on secondary CTA button
[SKILL] Fixing issues before codex-review...

[REVIEW] Invoking /codex-review...
[REVIEW] Waiting for Codex review completion...
[REVIEW] Review complete - 1 finding(s):
  - P3 (minor): Image could benefit from blur placeholder

[FIX] Retry 1/3 - Fixing 1 finding(s)...
[SKILL] Invoking /vercel-react-best-practices for image optimization guidance...
[FIX] Added blur placeholder using Next.js Image component

[REVIEW] Re-invoking /codex-review...
[REVIEW] Waiting for Codex review completion...
[REVIEW] Review complete - PASSED

[COMMIT] Creating commit (passed after 1 fix iteration)...
feat(hero): Implement Hero section with responsive layout

Review: Passed after 1 fix iteration
Fixed:
- [P3]: Added blur placeholder for hero image

[STATUS] Updating task to [x]
```

### Example: Max Retries Exhausted

```
[REVIEW] Review complete - 1 finding(s):
  - P1 (critical): Form data not properly sanitized

[FIX] Retry 1/3 - Fixing 1 finding(s)...
[FIX] Added input sanitization

[REVIEW] Re-invoking /codex-review...
[REVIEW] Review complete - 1 finding(s):
  - P2 (moderate): Sanitization incomplete for special characters

[FIX] Retry 2/3 - Fixing 1 finding(s)...
[FIX] Extended sanitization to handle special characters

[REVIEW] Re-invoking /codex-review...
[REVIEW] Review complete - 1 finding(s):
  - P2 (moderate): Edge case with unicode characters

[FIX] Retry 3/3 - Fixing 1 finding(s)...
[FIX] Added unicode normalization

[REVIEW] Re-invoking /codex-review...
[REVIEW] Review complete - 1 finding(s):
  - P1 (critical): Requires comprehensive input validation library

[STOP] Max retries (3) exhausted. Manual intervention required.
[STOP] Remaining issue: P1 - Requires comprehensive input validation library
[STOP] Changes left uncommitted for manual review.
[STOP] Task remains unchecked - [ ]
```

## Error Handling

### Required Documents Missing
```
If dev-docs/to-do.md does not exist:
  Report: "Tasks document not found. Please run /to-do first."
  Exit - cannot proceed without tasks

If dev-docs/prd.md does not exist:
  Report: "PRD not found. Please run /prd first to define product requirements."
  Exit - cannot proceed without PRD

If dev-docs/trd.md does not exist:
  Report: "TRD not found. Please run /trd first to define technical specifications."
  Exit - cannot proceed without TRD
```

### Task Not Found
```
If no incomplete tasks found:
  Report: "All tasks are complete. No work to do."
  Exit gracefully
```

### Phase Dependency Not Met
```
If task depends on incomplete phase:
  Report: "Task in Phase X depends on Phase Y which is not complete."
  Skip to next available task or report blocked status
```

### Review Timeout
```
If codex-review exceeds 60-minute timeout:
  Report: "Review timed out after 60 minutes."
  Keep changes staged but uncommitted
  Stop execution for manual intervention
```

### Git Errors
```
If git operations fail:
  Report the specific git error
  Do not update task status
  Stop execution
```

## Success Criteria

A successful autonomous-dev session:
- Completes one or more tasks fully
- **Each completed task passes Codex review (MANDATORY - no commits without review)**
- All commits follow the message format
- Task checkboxes are accurately updated in `dev-docs/to-do.md`
- Implementation matches PRD requirements and TRD specifications
- Platform-specific best practices are applied (React, accessibility, etc.)
- Session ends cleanly (all tasks done or review failure)

**REMINDER:** A task is NEVER considered complete until /codex-review has been run and passed.

## Manual Override Options

If needed, you can:
- Skip a task by commenting it out with a note
- Force continue after failure by manually checking the box and re-running
- Start from a specific phase by manually checking prior tasks

## Notes

- The skill processes tasks sequentially, one at a time
- Parallel task execution is not supported
- Always verify the working directory is the project root
- Large tasks may need multiple review cycles
- Keep the session running until natural completion or failure

**Complete Development Workflow:**
```
1. /prd <product idea>     → Creates dev-docs/prd.md (product requirements)
2. /trd                    → Creates dev-docs/trd.md (technical specification)
3. /to-do                  → Creates dev-docs/to-do.md (task breakdown)
4. /autonomous-development → Executes tasks sequentially with review/commit
```

**Document Traceability:**
- Tasks in `to-do.md` reference PRD/TRD sections (e.g., `TRD 3.2`, `PRD FR-001`)
- When implementing a task, look up the referenced section for detailed context
- This ensures implementations match specifications

**Skill Invocation:**
- Use `/vercel-react-best-practices` skill for React/Next.js performance guidance (optional)
- Use `/web-design-guidelines` skill to audit UI components for accessibility (optional)
- **Use `/codex-review` skill for code validation before commits (COMPULSORY - MUST run after EVERY task)**
- Skills can be invoked multiple times during a single task as needed
- Invoke skills using the Skill tool with `skill:` and optional `args:` parameters

**⚠️ FINAL REMINDER: /codex-review is NOT optional. It MUST be run after completing each task before committing.**
